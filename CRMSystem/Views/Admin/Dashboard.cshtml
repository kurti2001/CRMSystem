@* File: Views/Admin/Dashboard.cshtml *@

@using CRMSystem.Controllers

@{
    ViewData["Title"] = "Manager Dashboard";
    var leadCount = (int)ViewBag.LeadCount;
    var opportunityCount = (int)ViewBag.OpportunityCount;
    var customerCount = (int)ViewBag.CustomerCount;
    var totalContacts = (int)ViewBag.TotalContacts;
    var openTasks = (int)ViewBag.OpenTasks;
    var openMeetings = (int)ViewBag.OpenMeetings;
    var overdueTasks = (int)ViewBag.OverdueTasks;
    var overdueMeetings = (int)ViewBag.OverdueMeetings;
    var totalUsers = (int)ViewBag.TotalUsers;
    var activeUsers = (int)ViewBag.ActiveUsers;
    var repStats = (List<SalesRepStat>)ViewBag.RepStats;
}

<h1>Manager Dashboard</h1>
<hr />

<!-- Contact Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <a asp-action="Contacts" class="text-decoration-none">
            <div class="card text-white bg-primary shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1">Total Contacts</h6>
                            <h2 class="mb-0">@totalContacts</h2>
                        </div>
                        <i class="bi bi-people fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-action="Contacts" asp-route-status="Lead" class="text-decoration-none">
            <div class="card text-white bg-info shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1">Leads</h6>
                            <h2 class="mb-0">@leadCount</h2>
                        </div>
                        <i class="bi bi-funnel fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-action="Contacts" asp-route-status="Opportunity" class="text-decoration-none">
            <div class="card text-white bg-warning shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1 text-dark">Opportunities</h6>
                            <h2 class="mb-0 text-dark">@opportunityCount</h2>
                        </div>
                        <i class="bi bi-graph-up fs-1 opacity-50 text-dark"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-action="Contacts" asp-route-status="Customer" class="text-decoration-none">
            <div class="card text-white bg-success shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1">Customers</h6>
                            <h2 class="mb-0">@customerCount</h2>
                        </div>
                        <i class="bi bi-trophy fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Activity & Users Summary -->
<div class="row mb-4">
    <div class="col-md-3">
        <a asp-action="AllTasks" class="text-decoration-none">
            <div class="card border-start border-4 border-warning shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted mb-1">Open Tasks</h6>
                    <h3 class="mb-0">@openTasks</h3>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-action="AllTasks" class="text-decoration-none">
            <div class="card border-start border-4 border-danger shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted mb-1">Overdue Tasks</h6>
                    <h3 class="mb-0 text-danger">@overdueTasks</h3>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <div class="card border-start border-4 border-info shadow-sm">
            <div class="card-body">
                <h6 class="text-muted mb-1">Open Meetings</h6>
                <h3 class="mb-0">@openMeetings</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <a asp-action="Users" class="text-decoration-none">
            <div class="card border-start border-4 border-success shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted mb-1">Active Users</h6>
                    <h3 class="mb-0">@activeUsers <small class="fs-6 text-muted">/ @totalUsers</small></h3>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Sales Rep Performance Table -->
<div class="card shadow-sm mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Team Overview</h5>
        <a asp-action="Users" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-gear"></i> Manage Users
        </a>
    </div>
    <div class="card-body p-0">
        @if (repStats.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th class="text-center">Contacts</th>
                            <th class="text-center">Open Tasks</th>
                            <th class="text-center">Open Meetings</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var rep in repStats)
                        {
                            <tr>
                                <td class="fw-semibold">@rep.FullName</td>
                                <td>@rep.Email</td>
                                <td>
                                    <span class="badge @(rep.Role == "Manager" ? "bg-danger" : "bg-info")">
                                        @rep.Role
                                    </span>
                                </td>
                                <td class="text-center">
                                    <a asp-action="Contacts" asp-route-salesRepId="@rep.UserId" class="text-decoration-none">
                                        @rep.ContactCount
                                    </a>
                                </td>
                                <td class="text-center">
                                    <a asp-action="AllTasks" asp-route-salesRepId="@rep.UserId" class="text-decoration-none">
                                        @rep.OpenTaskCount
                                    </a>
                                </td>
                                <td class="text-center">@rep.OpenMeetingCount</td>
                                <td class="text-center">
                                    <a asp-action="Contacts" asp-route-salesRepId="@rep.UserId"
                                       class="btn btn-sm btn-outline-primary" title="View contacts">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="p-3 text-muted">No users found.</div>
        }
    </div>
</div>

<!-- Quick Links -->
<div class="row">
    <div class="col-md-4 mb-3">
        <a asp-controller="Contacts" asp-action="Create" class="text-decoration-none">
            <div class="card shadow-sm text-center p-3">
                <i class="bi bi-person-plus fs-1 text-primary"></i>
                <h6 class="mt-2 mb-0">New Contact</h6>
            </div>
        </a>
    </div>
    <div class="col-md-4 mb-3">
        <a asp-controller="Account" asp-action="Register" class="text-decoration-none">
            <div class="card shadow-sm text-center p-3">
                <i class="bi bi-person-gear fs-1 text-success"></i>
                <h6 class="mt-2 mb-0">Register User</h6>
            </div>
        </a>
    </div>
    <div class="col-md-4 mb-3">
        <a asp-action="Users" class="text-decoration-none">
            <div class="card shadow-sm text-center p-3">
                <i class="bi bi-people-fill fs-1 text-secondary"></i>
                <h6 class="mt-2 mb-0">Manage Users</h6>
            </div>
        </a>
    </div>
</div>
